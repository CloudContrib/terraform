# Starter pipeline
# YAML reference documentation : https://docs.microsoft.com/en-us/azure/devops/pipelines/yaml-schema?view=azure-devops&tabs=schema&viewFallbackFrom=vsts
# GitHub service connection : https://docs.microsoft.com/en-us/azure/devops/pipelines/library/service-endpoints?view=azure-devops#sep-github

name: $(BuildDefinitionName).$(DayOfYear)$(Rev:.r)

variables:
- group: terraform_binary  # variable group
- name: main_backend_secret_file_id1234
  value: 'backend-main-jdld-1.json'
- name: main_secret_file_id34
  value: 'main-jdld-1.json'
      
trigger:
  batch: true #when a build is running, the system waits until the build is completed
  branches:
    include:
      - master
      - feature/*
  paths:
    include:
    - Best-Practice/*

resources:
  repositories:
    - repository: terraform # identifier (A-Z, a-z, 0-9, and underscore)
      type: github
      endpoint: JamesDLD  # name of the service connection to use (for non-Azure Repos types)
      name: JamesDLD/terraform
      ref: refs/heads/feature/terraform0.12 # optional ref to pin to

stages:
- stage: Deployment
  jobs:
  - job: Linux
    pool:
      vmImage: 'ubuntu-16.04'
    steps:
    - template: pipeline/test.yml@terraform # Template reference

  - job: macOS
    pool:
      vmImage: 'macOS-10.13'
    steps:
    - template: pipeline/test.yml@terraform # Template reference
  